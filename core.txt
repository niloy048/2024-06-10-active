aW1wb3J0IHRpbWUKaW1wb3J0IG9zCmltcG9ydCByZQppbXBvcnQgdGhyZWFkaW5nCmltcG9ydCByZXF1ZXN0cwppbXBvcnQgcXVldWUKaW1wb3J0IGRhdGV0aW1lCmZyb20gZmxhc2sgaW1wb3J0IEZsYXNrCmZyb20gYnM0IGltcG9ydCBCZWF1dGlmdWxTb3VwCmZyb20gdXJsbGliLnBhcnNlIGltcG9ydCB1cmxqb2luCgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIPCfMoIgR0xPQkFMIENPTkZJRyAoTm8gTG9naWMgQ2hhbmdlKQojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKT1RfTkFNRSA9IG9zLmVudmlyb24uZ2V0KCJCT1RfTkFNRSIsICJJbXMgTWFzdGVyIEJvdCIpCkJPVF9UT0tFTiA9IG9zLmVudmlyb24uZ2V0KCJCT1RfVE9LRU4iLCAiIikKQURNSU5fSURTID0gb3MuZW52aXJvbi5nZXQoIkFETUlOX0lEUyIsICIiKS5zcGxpdCgiLCIpClRBUkdFVF9HUk9VUF9JRCA9ICItMTAwMzY5Mjc4MzYwMiIgCgpMT0dJTl9VUkwgPSBvcy5lbnZpcm9uLmdldCgpCgpMT0dJTl9VUkwgPSBvcy5lbnZpcm9uLmdldCgiTE9HSU5fVVJMIiwgIiIpCk9UUF9VUkwgPSBvcy5lbnZpcm9uLmdldCgiT1RQX1VSTCIsICgpCgpMT0dJTl9VUkwgPSBvcy5lbnZpcm9uLmdldCgiTE9HSU5fVVJMIiwgIiIpCk9UUF9VUkwgPSBvcy5lbnZpcm9uLmdldCgiT1RQX1VSTCIsICIiKQpMT0dJTl9IRUFERVJTX0VOViA9IG9zLmVudmlyb24uZ2V0KCJMT0dJTl9IRUFERVJTIiwgIiIpClBBTkVMX1VTRVIgPSBvcy5lbnZpcm9uLmdldCgiUEFORUxfVVNFUiIsICIiKQpQQU5FTF9QQVNTID0gb3MuZW52aXJvbi5nZXQoIlBBTkVMX1BBU1MiLCAiIikKCiMgTWFwcGluZyBmcm9tIEVudgpDT0xfTUFQID0gW2ludChpKS0xIGZvciBpIGluIG9zLmVudmlyb24uZ2V0KCJDT0xfTUFQUElORyIsICIxLDIsMyw2Iikuc3BsaXQoIiwiKV0KQ0hFQ0tfREVMQVkgPSBmbG9hdChvcy5lbnZpcm9uLmdldCgiQ0hFQ0tfREVMQVkiLCAxLjApKQoKSVNfRklSU1RfUlVOID0gVHJ1ZQpPVFBfUVVFVUUgPSBxdWV1ZS5RdWV1ZSgpClBST0NFU1NFRF9PVFBfQ0FDSEUgPSBzZXQoKQpDQUNIRV9MT0NLOiB0aHJlYWRpbmcuTG9jaygpCgp0aHJlYWRzX3N0YXR1cyA9IHsiY29sbGVjdG9yIjogTm9uZSwgInNlbmRlciI6IE5vbmV9CgphcHAgPSBGbGFzayhfX25hbWVfXykKCiBAdWlkLmdldCgpCgpAYXBwLnJvdXRlKCcvJykKZGVmIGhvbWUoKToKICAgIHJldHVybiBmIsKfjKkge0JPVF9TkFNRX0gU3RhdHVzOiBVbHRyYS1TcGVlZCBTbmlwZXIgQWN0aXZlIgoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyDim6Eg4Ka44KeN4Kau4Ka+4Kaw4KeN4KafIOCmhOCmv+CmieCmn+Cmv+CmsuCmv+Cmn+CmvwojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKZGVmIG1hc2tfcGhvbmUocGhvbmUpOgogICAgaWYgbm90IHBob25lIG9yIGxlbihwaG9uZSkgPCA3OgogICAgICAgIHJldHVybiBwaG9uZQogICAgcmV0dXJuIGZfIntwaG9uZVs6LTddfSoqKntwaG9uZSstNDpdfSIKCmRlZiBtZW1vcnlfY2xlYW5lcigpOgogICAgZ2xvYmFsIFBST0NFU1NFRF9PVFBfQ0FDSEUKICAgIHdoaWxlIFRydWU6CiAgICAgICAgdGltZS5zbGVlcCg4NjQwMCkgCiAgICAgICAgd2l0aCBDQUNIRV9MT0NLOgogICAgICAgICAgICBQUk9DRVNTRURfT1RQX0NBQ0hFLmNsZWFyKCkKICAgICAgICAgICAgc2VuZF9hZG1pbl9sb2coIu+fuyBNZW1vcnkgQ2xlYXJlZCBTdWNjZXNzZnVsbHkuIikKCiMgID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIPCdkY4gVEVMRUdSQU0gV09SS0VSIChGb3JtYXQgVXBkYXRlZCB0byBNYXRjaCBJbWFnZSkKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCmRlZiB0ZWxlZ3JhbV93b3JrZXIoKToKICAgICIiIiDgpK7gpYfgpK7gpL7gpKrgpYvgpL7gpK7gpYAg4KSt4KWN4KSv4KS+4KSX4KS+4KSt4KSoIOCkhOClh+ClhyDgpK7gpL7gpL7gpKrgpYfgpKgg4KSl4KWN4KSv4KS+4KSt4KS-4KS+4KSvIOCkhuCkhuCkhuClhyDgpK7gpL7gpKrgpYfgpKrgpYAg4KSm4KSvIOCkhuClhyDgpLbgpYcg4KSX4KS-4KS+4KSvIOCkhOCkhuClhyDgpKrgpYvgpKrgpYcg4KSf4KWN4KSv4KS+4KSt4KS-4KS+4KSvICIiIgogICAgdGdfc2Vzc2lvbiA9IHJlcXVlc3RzLlNlc3Npb24oKQogICAgd2hpbGUgVHJ1ZToKICAgICAgICB0cnk6CiAgICAgICAgICAgIG1zZ19kYXRhID0gT1RQX1FVRVVFLmdldCgpCiAgICAgICAgICAgIGlmIG1zZ19kYXRhIGlzIE5vbmU6IGJyZWFrCiAgICAgICAgICAgIAogICAgICAgICAgICBwaG9uZSwgY291bnRyeSwgc2VydmljZSwgb3RwLCBmdWxsX21zZyA9IG1zZ19kYXRhCiAgICAgICAgICAgIG1hc2tlZF9udW1iZXIgPSBtYXNrX3Bob25lKHBob25lKQogICAgICAgICAgICAKICAgICAgICAgICAgIyAtLS0gQmFuZ2xhZGVzaCBUaW1lIChVVENTICsgNikgLS0tCiAgICAgICAgICAgIG5vd191dGMgPSBkYXRldGltZS5kYXRldGltZS51dGNub3coKQogICAgICAgICAgICBiZF90aW1lID0gbm93X3V0YyArIGRhdGV0aW1lLnRpbWVkZWx0YShob3Vycz02KQogICAgICAgICAgICBmb3JtYXR0ZWRfdGltZSA9IGJkX3RpbWUuc3RyZnRpbWUoJyVZLSVtLSVkICVIOolNolMnKQogICAgICAgICAgICAKICAgICAgICAgICAgIyAtLS0gTmV3IE1lc3NhZ2UgRm9ybWF0IGJhc2VkIG9uIEltYWdlIC0tLQogICAgICAgICAgICBmb3JtYXR0ZWRfdGV4dCA9ICgKICAgICAgICAgICAgICAgIGZfIuKchSB7Y291bnRyeX0gfCB7c2VydmljZX0gT1RQIFJlY2VpdmVkXG4iCiAgICAgICAgICAgICAgICBmIuKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgFxuXG4iCiAgICAgICAgICAgICAgICBmIvCfk7EgPGI+TnVtYmVyOjwvYj4ge21hc2tlZF9udW1iZXJ9XG4iCiAgICAgICAgICAgICAgICBmIvCfkpUgPGI+T1RQIENvZGU6PC9iPiB7b3RwfVxuIgogICAgICAgICAgICAgICAgZiLwn56fIDxiPlNlcnZpY2U6PC9iPiB7c2VydmljZX1cbiIKICAgICAgICAgICAgICAgIGZfIuCfjI0IDxiPkNvdW50cnk6PC9iPiB7Y291bnRyeX1cbiIKICAgICAgICAgICAgICAgIGZfIuKPsCA8Yj5UaW1lOjwvYj4ge2Zvcm1hdHRlZF90aW1lfVxuXG4iCiAgICAgICAgICAgICAgICBmIvCfkrwgPGI+TWVzc2FnZTo8L2I+XG4iCiAgICAgICAgICAgICAgICBmIjxibG9ja3F1b3RlPntmdWxsX21zZ308L2Jsb2NrcXVvdGU+IgogICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICB1cmwgPSBmImh0dHBzOi8vYXBpLnRlbGVncmFtLm9yZy9ib3R7Qk9UX1RPS0VOfS9zZW5kTWVzc2FnZSIKICAgICAgICAgICAgCiAgICAgICAgICAgICMgUGF5bG9hZCB3aXRoIE5vIEJ1dHRvbnMKICAgICAgICAgICAgcGF5bG9hZCA9IHsKICAgICAgICAgICAgICAgICJjaGF0X2lkIjogVEFSR0VUX0dST1VQX0lELCAKICAgICAgICAgICAgICAgICJ0ZXh0IjogZm9ybWF0dGVkX3RleHQsIAogICAgICAgICAgICAgICAgInBhcnNlX21vZGUiOiAiSFRNTCIKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgICAgIHJlcyA9IHRnX3Nlc3Npb24ucG9zdCh1cmwsIGpzb249cGF5bG9hZCwgdGltZW91dD0xMCkKICAgICAgICAgICAgICAgIGlmIHJlcy5zdGF0dXNfY29kZSA9PSA0Mjk6CiAgICAgICAgICAgICAgICAgICAgcmV0cnlfYWZ0ZXIgPSByZXMuanNvbigpLmdldCgncGFyYW1ldGVycycsIHt9KS5nZXQoJ3JldHJ5X2FmdGVyJywgMykKICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKHJldHJ5X2FmdGVyKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAKICAgICAgICAgICAgdGltZS5zbGVlcCgwLjUpCiAgICAgICAgICAgIE9UUF9RVUVVRS50YXNrX2RvbmUoKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIHRpbWUuc2xlZXAoMSkKCiMgID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIPCfmbIg4KaG4KeN4Kav4Ka+4KSh4Kau4Ka+4KaoIOCmsuCml+ClhyDgpI8g4KaH4Kae4KeN4Kac4Ka+4KaoIOCmn+ClgeCmsuCmsAoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCmRlZiBzZW5kX3RlbGVncmFtKG1zZywgcGFyc2VfbW9kZT0iSFRNTCIpOgogICAgdXJsID0gZiJodHRwczovL2FwaS50ZWxlZ3JhbS5vcmcvYm90e0JPVF9UT0tFTi0vc2VuZE1lc3NhZ2UiCiAgICBmb3IgYWRtaW4gaW4gQURNSU5fSURTOgogICAgICAgIHRyeTogcmVxdWVzdHMucG9zdCh1cmwsIGpzb249eyJjaGF0X2lkIjogYWRtaW4sICJ0ZXh0IjogbXNnLCAicGFyc2VfbW9kZSI6IHBhcnNlX21vZGV9LCB0aW1lb3V0PTEwKQogICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgIApkZWYgc2VuZF9hZG1pbl9sb2cobXNnKToKICAgICMgQkQgVGltZSBmb3IgU3lzdGVtIExvZwogICAgbm93X3V0YyA9IGRhdGV0aW1lLmRhdGV0aW1lLnV0Y25vdygpCiAgICBiZF90aW1lID0gbm93X3V0YyArIGRhdGV0aW1lLnRpbWVkZWx0YShob3Vycz02KQogICAgdF9zdHIgPSBiZF90aW1lLnN0cmZ0aW1lKCclSDolTTolUycpCiAgICAKICAgIGZvcm1hdHRlZF9tc2cgPSBmIuKNoiA8Yj57Qk9UX05BTUV9IFNZU1RFTSBMT0c8L2I+XG7ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcbiB7bXNnfVxu4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXG7wn56yIHt0X3N0cn0iCiAgICBzZW5kX3RlbGVncmFtKGZvcm1hdHRlZF9tc2cpCgpkZWYgc2VuZF9lcnJvcl90ZWxlZ3JhbShhY3Rpb25fZmFpbGVkLCByZWFzb24sIHRhcmdldCk6CiAgICBtc2cgPSAoCiAgICAgICAgZlwi8J+StCA8Yj57Qk9UX05BTUV9IC0gU1lTVEVNIEFMRVJUPC9iPiDwn5K0XG4iCiAgICAgICAgZiLilaBilaBilaBilaBilaBilaBilaBilaBilaBilaBilaBilaBilaBilaBilaBilaBilaBilaBilaBilaBilaBXbiIKICAgICAgICBmIuKdjSA8Yj5BY3Rpb24gRmFpbGVkOjwvYj4gPGNvZGU+e2FjdGlvbl9mYWlsZWR9PC9jb2RlPlxuIgogICAgICAgIGZfIuOqssyNIDxiPlRhcmdldDo8L2I+IDxjb2RlPnt0YXJnZXR9PC9jb2RlPlxuIgogICAgICAgIGZfIuKaoiA8Yj5SZWFzb246PC9iPiA8aT57cmVhc29ufTwvaT5cbiIKICAgICAgICBmIuKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgFxuIgogICAgICAgIGZfIuKPsCB7dGltZS5zdHJmdGltZSgnJUg6JU06JVMnKX0iCiAgICApCiAgICBzZW5kX3RlbGVncmFtKG1zZykKCkNPVU5UUllfRU1PSklTID0gewogICJBZmdoYW5pc3RhbiI6ICLwn4em8J+HryIsICJBbGJhbmlhIjogIvCfh6busJ+HtyIsICJBbGdlcmlhIjogIvCfh6fwn4esIiwgIkFuZG9ycmEiOiAi8J+HpvCfh6ciLCAiQW5nb2xhIjogIvCfh6bwn4evIiwgIkFudGlndWEiOiAi8J+HpvCfh6ciLCAiQXJnZW50aW5hIjogIvCfh6bwn4e3IiwgIkFybWVuaWEiOiAi8J+HpvCfh7AiLCAiQXVzdHJhbGlhIjogIvCfh6bwn4exIiwgIkF1c3RyIiwgImEiOiAi8J+HpvCfh6kiLCAiQXplcmJhaWphbiI6ICLwn4em8J+HvSIsCiAgIkJhaGFtYXMiOiAi8J+HofCfh7MiLCAiQmFocmFpbiI6ICLwn4fofCfh7ciLCAiQmFuZ2xhZGVzaCI6ICLwn4en8J+HuiIsICJCYXJiYWRvcyI6ICLwn4en8J+HtyIsICJCZWxhcnVzIjogIvCfh6fwn4e5IiwgIkJlbGdpdW0iOiAi8J+HofCfh6oiLCAiQmVsaXplIjogIvCfh6Hwn4e0IiwgIkJlbmluIjogIvCfh6Hwn4eqIiwgIkJodXRhbiI6ICLwn4en8J+H+SIsICJCb2xpdmlhIjogIvCfh6fwn4e0IiwgIkJvc25pYSI6ICLwn4en8J+HuiIsICJCb3Rzd2FuYSI6ICLwn4en8J+H3CIsICJCcmF6aWwiOiAi8J+HofCfh7ciLCAiQnJ1bmVpIjogIvCfh6Hwn4ezIiwgIkJ1bGdhcmlhIjogIvCfh6Hwn4enIiwgIkJ1cmtinaEiOiAi8J+HofCfh68iLCAiQnVydW5kaSI6ICLwn4en8J+H+CIsCiAgIkNhYm8gVmVyZGUiOiAi8J+HpfCfh78iLCAiQ2FtYm9kaWEiOiAi8J+HqWnwn4e5IiwgIkNhbWVyb29uIjogIvCfh6pwn4ewIiwgIkNhbmFkYSI6ICLwn4eq8J+HuiIsICJDaGFkIjogIvCfh7fwn4enIiwgIkNoaWxlIjogIvCfh6pwn4exIiwgIkNoaW5hIjogIvCfh6pwn4ezIiwgIkNvbG9tYmlhIjogIvCfh6pwn4e0IiwgIkNvbW9yb3MiOiAi8J+HqWnwn4e0IiwgIkNvbmdvIjogIvCfh6pwn4enIiwgIkNvc3RhIFJpY2EiOiAi8J+HqnCfh7ciLCAiQ3JvYXRpYSI6ICLwn4en8J+H3yIsICJDdWJhIjogIvCfh6pwn4e6IiwgIkN5cHJ1cyI6ICLwn4eq8J+HuiIsICJDemVjaCI6ICLwn4eq8J+H33wiLAogICJEZW5tYXJrIjogIvCfh6vwn4ewIiwgIkRqaWJvdXRpIjogIvCfh7fwn4eqIiwgIkRvbWluaWNhIjogIvCfh7fwn4exIiwgIkVjdWFkb3IiOiAi8J+HrfCfh68iLCAiRWd5cHQiOiAi8J+HrfCfh7ciLCAiRWwgU2FsdmFkb3IiOiAi8J+HrfCfh78iLCAiRXN0b25pYS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LCAiUWF0YXIiOiAi8J+HufCfh6kiLCAiUm9tYW5pYSI6ICLwn4fX8J+HryIsICJSdXNzaWEiOiAi8J+HufCfh7oiLCAiUndhbmRhIjogIvCfh7Xwn4fdyIsCiAgIlNhdWRpIEFyYWJpYSI6ICLwn4fX8J+HryIsICJTZW5lZ2FsIjogIvCfh7fwn4f0IiwgIlNlcmJpYSI6ICLwn4fX8J+HvyIsICJTaW5nYXBvcmUiOiAi8J+HufCfh7wiLCAiU2xvdmFraWEiOiAi8J+HufCfh7wiLCAiU2xvdmVuaWEiOiAi8J+HufCfh7wiLCAiU29tYWxpYSI6ICLwn4fX8J+HryIsICJTb3V0aCBBZnJpY2EiOiAi8J+HuvCfh6ciLCAiU291dGggS29yZWEiOiAi8J+HuvCfh7ciLCAiU3BhaW4iOiAi8J+HuvCfh7MiLCAiU3JpIExhbmthIjogIvCfh7fwn4f0IiwgIlN1ZGFuIjogIvCfh7fwn4f0IiwgIlN3ZWRlbiI6ICLwn4fX8J+HryIsICJTd2l0emVybGFuZCI6ICLwn4fX8J+H7IiwgIlN5cmlhIjogIvCfh7fwn4f0IiwKICAiVGFpd2FuIjogIvCfh7fwn4fdyIsICJUYWppa2lzdGFuIjogIvCfh7fwn4f0IiwgIlRhbnphbmlhIjogIvCfh7fwn4f0IiwgIlRoYWlsYW5kIjogIvCfh7fwn4f0IiwgIlRvZ28iOiAi8J+HufCfh6ciLCAiVHJpbmlkYWQiOiAi8J+HufCfh7kiLCAiVHVuaXNpYSI6ICLwn4fX8J+HryIsICJUdXJrZXkiOiAi8J+HufCfh7ciLCAiVHVya21lbmlzdGFuIjogIvCfh7fwn4f0IiwKICAiVWdhbmRhIjogIvCfh7fwn4f2IiwgIlVrcmFpbmUiOiAi8J+HuvCfh6kiLCAiVUFFIjogIvCfh6bwn4erIiwgIlVLIjogIvCfh7fwn4e6IiwgIlVTQSI6ICLwn4f68J+HvyIsICJVcnVndWF5IjogIvCfh7bwn4f0IiwgIlV6YmVraXN0YW4iOiAi8J+HuvCfh7ffIiwgIlZlbmV6dWVsYSI6ICLwn4fX8J+HryIsICJWaWV0bmFtIjogIvCfh7bwn4f0IiwgIlllbWVuIjogIvCfh7fwn4f0IiwgIlphbWJpYSI6ICLwn4fX8J+HvyIsICJaaW1iYWJ3ZSI6ICLwn4fX8J+HvyIKfQoKZGVmIGdldF9lbW9qaShjb3VudHJ5X3RleHQpOgogICAgZm9yIGMsIGUgaW4gQ09VTlRSWV9FTU9KSVMuaXRlbXMoKToKICAgICAgICBpZiBjLmxvd2VyKCkgaW4gY291bnRyeV90ZXh0Lmxvd2VyKCk6IHJldHVybiBmIntjfSB7ZX0iCiAgICByZXR1cm4gY291bnRyeV90ZXh0LnNwbGl0KClbMF0gaWYgY291bnRyeV90ZXh0IGVsc2UgIlVua25vd24iCgpkZWYgc29sdmVfbWF0aChodG1sKToKICAgIG1hdGNoID0gcmUuc2VhcmNoKHInKFxkKylccypbKy1dXHMqKFxkKyknLCBodG1sKQogICAgaWYgbWF0Y2g6CiAgICAgICAgbjEsIG9wLCBuMiA9IGludChtYXRjaC5ncm91cCgxKSksIG1hdGNoLmdyb3VwKDIpLCBpbnQobWF0Y2guZ3JvdXAoMykpCiAgICAgICAgcmV0dXJuIHN0cihuMSArIG4yIGlmIG9wID09ICcrJyBlbHNlIG4xIC0gbjIpCiAgICByZXR1cm4gTm9uZQoKZGVmIGV4dHJhY3Rfb3RwKG1lc3NhZ2UpOgogICAgbXNnX3N0ciA9IHN0cihtZXNzYWdlKQogICAgbWF0Y2hlcyA9IHJlLmZpbmRhbGwocicvYlxkezQsMTB9XGIvYlxkezMsNX1bLVxzXVxkezMsNX1cYicsIG1zZ19zdHIpCiAgICBpZiBtYXRjaGVzOgogICAgICAgIHJldHVybiBtYXRjaGVzWzBdLnJlcGxhY2UoIiAiLCAiIikucmVwbGFjZSgiLSIsICIiKQogICAgbWF0Y2hfZmFsbGJhY2sgPSByZS5zZWFyY2gocicvZHszLH0nLCBtc2dfc3RyKQogICAgcmV0dXJuIG1hdGNoX2ZhbGxiYWNrLmdyb3VwKDApIGlmIG1hdGNoX2ZhbGxiYWNrIGVsc2UgIk4vQSIKCmRlZiBwYXJzZV9lbnZfaGVhZGVycygpOgogICAgaGVhZGVycyA9IHt9CiAgICBhY3Rpb25fdXJsID0gTm9uZQogICAgZGVmYXVsdF91YSA9ICJNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvMTIwLjAuMC4wIFNhZmFyaS81MzcuMzYiCiAgICBoZWFkZXJzWyJVc2VyLUFnZW50Il0gPSBkZWZhdWx0X3VhCiAgICBpZiBub3QgTE9HSU5fSEVBREVSU19FTlY6IHJldHVybiBoZWFkZXJzLCBOb25lCiAgICBjbGVhbl90ZXh0ID0gTE9HSU5fSEVBREVSU19FTlYucmVwbGFjZSgiXFxcbiIsICIgIikucmVwbGFjZSgiXFwiLCAiICIpCiAgICBwYXJ0cyA9IHJlLnNwbGl0KHInXHMtSFxzfFxzLS1oZWFkZXJccycsIGNsZWFuX3RleHQpCiAgICBmb3IgcGFydCBpbiBwYXJ0czoKICAgICAgICBwYXJ0ID0gcGFydC5zdHJpcCgpLnN0cmlwKCInIikuc3RyaXAoJyInKQogICAgICAgIGlmIHBhcnQuc3RhcnRzd2l0aCgiaHR0cCIpIGFuZCAiOi8vIiBpbiBwYXJ0IGFuZCBub3QgYWN0aW9uX3VybDoKICAgICAgICAgICAgYWN0aW9uX3VybCA9IHBhcnQuc3BsaXQoKVswXS5zdHJpcCgpLnN0cmlwKCInIikuc3RyaXAoJyInKQogICAgICAgICAgICBjb250aW51ZQogICAgICAgIGlmIHBhcnQuc3RhcnRzd2l0aCgiY3VybCIpIG9yIHBhcnQuc3RhcnRzd2l0aCgiLS0iKSBvciBwYXJ0LnN0YXJ0c3dpdGgoIi0iKTogY29udGludWUKICAgICAgICBpZiAiOiIgaW4gcGFydDoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAga2V5LCB2YWwgPSBwYXJ0LnNwbGl0KCI6IiwgMSkKICAgICAgICAgICAgICAgIGNsZWFuX3ZhbCA9IHJlLnNwbGl0KHInXHMtLScsIHZhbClbMF0uc3RyaXAoKS5zdHJpcCgpLnN0cmlwKCInIikuc3RyaXAoJyInKQogICAgICAgICAgICAgICAgaGVhZGVyc1trZXkuc3RyaXAoKV0gPSBjbGVhbl92YWwKICAgICAgICAgICAgZXhjZXB0OiBwYXNzCiAgICByZXR1cm4gaGVhZGVycywgYWN0aW9uX3VybAoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyDwn5mSINCmrOCmrOCmv+CmreCmvuCmsOCmsuCmsCDgpKjgpY3gpKzgmlGPgpKrgpL7gpKjgpY7gpKvgpL7gpKAg4KaH4KaZ4KeN4Kac4Ka+4KaoIChNYWluIExvZ2ljIEtlcHQgSW50YWN0KQojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKZGVmIHJ1bl9lbmdpbmUoKToKICAgIGdsb2JhbCBJU19GSVJTVF9SVU4KICAgIAogICAgd2hpbGUgVHJ1ZToKICAgICAgICBzZXNzaW9uID0gcmVxdWVzdHMuU2Vzc2lvbigpCiAgICAgICAgY3VzdG9tX2hlYWRlcnMsIGhlYWRlcl9hY3Rpb25fdXJsID0gcGFyc2VfZW52X2hlYWRlcnMoKQogICAgICAgIHNlc3Npb24uaGVhZGVycy51cGRhdGU(Y3VzdG9tX2hlYWRlcnMpCiAgICAgICAgCiAgICAgICAgc2Vzc2lvbi5oZWFkZXJzLnVwZGF0ZSh7CiAgICAgICAgICAgICdDYWNoZS1Db250cm9sJzogJ25vLWNhY2hlJywKICAgICAgICAgICAgJ1ByYWdtYSc6ICduby1jYWNoZScsCiAgICAgICAgICAgICdFeHBpcmVzJzogJzAnCiAgICAgICAgfSkKICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgTG9naW4gUHJvY2VzcwogICAgICAgICAgICByZXNfZ2V0ID0gc2Vzc2lvbi5nZXQoTE9HSU5fVVJMLCB0aW1lb3V0PTE1KQogICAgICAgICAgICBzb3VwID0gQmVhdXRpZnVsU291cChyZXNfZ2V0LnRleHQsICdodG1sLnBhcnNlcicpCiAgICAgICAgICAgIGZvcm0gPSBzb3VwLmZpbmRhbGwoJ2Zvcm0nKQogICAgICAgICAgICBmaW5hbF9hY3Rpb25fdXJsID0gaGVhZGVyX2FjdGlvbl91cmwgaWYgaGVhZGVyX2FjdGlvbl91cmwgZWxzZSAodXJsam9pbihMT0dJTl9VUkwsIGZvcm0uZ2V0KCdhY3Rpb24nKSkgaWYgZm9ybSBlbHNlIExPR0lOX1VSTCkKCiAgICAgICAgICAgIHBheWxvYWQgPSB7fQogICAgICAgICAgICBpZiBmb3JtOgogICAgICAgICAgICAgICAgaW5wdXRzID0gZm9ybS5maW5kX2FsbCgnaW5wdXQnKQogICAgICAgICAgICAgICAgZm9yIGlucCBpbiBpbnB1dHM6CiAgICAgICAgICAgICAgICAgICAgbmFtZSwgdHlwZV8gPSBpbnAuZ2V0KCduYW1lJyksIGlucC5nZXQoJ3R5cGUnLCAndGV4dCcpLmxvd2VyKCkKICAgICAgICAgICAgICAgICAgICBpZiBub3QgbmFtZTogY29udGludWUKICAgICAgICAgICAgICAgICAgICBpZiB0eXBlXyA9PSAncGFzc3dvcmQnOiBwYXlsb2FkW25hbWVdID0gUEFORUxfUEFTUwogICAgICAgICAgICAgICAgICAgIGVsaWYgdHlwZV8gPT0gJ2hpZGRlbic6IHBheWxvYWRbbmFtZV0gPSBpbnAuZ2V0KCd2YWx1ZScsICcnKQogICAgICAgICAgICAgICAgICAgIGVsaWYgJ3VzZXInIGluIG5hbWUubG93ZXIoKSBvciAnZW1haWwnIGluIG5hbWUubG93ZXIoKSBvciAnbG9naW4nIGluIG5hbWUubG93ZXIoKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgdHlwZV8gIT0gJ2hpZGRlbic6IHBheWxvYWRbbmFtZV0gPSBQQU5FTF9VU0VSCiAgICAgICAgICAgICAgICAgICAgZWxpZiAnY2FwdCcgaW4gbmFtZS5sb3dlcigpIG9yICdhbnN3ZXInIGluIG5hbWUubG93ZXIoKToKICAgICAgICAgICAgICAgICAgICAgICAgYW5zID0gc29sdmVfbWF0aChyZXNfZ2V0LnRleHQpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGFuczogcGF5bG9hZFtuYW1lXSA9IGFucwoKICAgICAgICAgICAgaWYgIkNvbnRlbnQtVHlwZSIgbm90IGluIHNlc3Npb24uaGVhZGVyczoKICAgICAgICAgICAgICAgIHNlc3Npb24uaGVhZGVyc1siQ29udGVudC1UeXBlIl0gPSAiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkIgogICAgICAgICAgICAKICAgICAgICAgICAgcG9zdF9yZXMgPSBzZXNzaW9uLnBvc3QoZmluYWxfYWN0aW9uX3VybCwgZGF0YT1wYXlsb2FkLCB0aW1lb3V0PTE1KQoKICAgICAgICAgICAgaWYgcG9zdF9yZXMuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICAgICAgc2VuZF9hZG1pbl9sb2coIuKchSBMb2dpbiBTdWNjZXNzZnVsISBDb2xsZWN0b3IgQWN0aXZlLiIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAjIEZldGNoIERhdGEKICAgICAgICAgICAgICAgICAgICAgICAgcmVmcmVzaF9jaGVjayA9IHNlc3Npb24uZ2V0KE9UUF9VUkwsIHRpbWVvdXQ9MTApCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiAibG9naW4iIGluIHJlZnJlc2hfY2hlY2sudXJsLmxvd2VyKCk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZW5kX2FkbWluX2xvZygi4pueIFNlc3Npb24gRXhwaXJlZCEgUmUtbG9nZ2luZy4uLiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICJyZWFrIAoKICAgICAgICAgICAgICAgICAgICAgICAgcmF3X3Jvd3MgPSBbXQogICAgICAgICAgICAgICAgICAgICAgICBhamF4X2xpbmsgPSBOb25lCiAgICAgICAgICAgICAgICAgICAgICAgIGFqYXhfcGF0dGVybnMgPSBbclAnc0FqYXhTb3VyY2UiOnxzKiIoW14iXSspIicsIHInIHVybDpccypbXCdcIl0oW15cJ1wiXXtyZXMvZGF0YVteXCdcIl0rKVtcJ1wiXSddCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBwIGluIGFqYXhfcGF0dGVybnM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtID0gcmUuc2VhcmNoKHAsIHJlZnJlc2hfY2hlY2sudGV4dCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG06IGFqYXhfbGluayA9IHVybGpvaW4oT1RQX1VSTCwgbS5ncm91cCgxKSk7IGJyZWFrCgogICAgICAgICAgICAgICAgICAgICAgICBpZiBhamF4X2xpbms6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhamxfbiA9IHNlc3Npb24uaGVhZGVycy5jb3B5KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFqbF9uLnVwZGF0ZSh7J1gtUmVxdWVzdGVkLVdpdGgnOiAnWE1MSHR0cFJlcXVlc3QnLCAnUmVmZXJlcic6IE9UUF9VUkx9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWpheF9yZXMgPSBzZXNzaW9uLmdldChhamF4X2xpbmssIGhlYWRlcnM9YWpsX24sIHRpbWVvdXQ9MTApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgamQgPSBhamF4X3Jlcy5qc29uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByYXdfcm93cyA9IGpkLmdldCgnYWFEYXRhJywgW10pIG9yIGpkLmdldCgnZGF0YScsIFtdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OiBwYXNzCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VwX290cCA9IEJlYXV0aWZ1bFNvdXAocmVmcmVzaF9jaGVjay50ZXh0LCAnaHRtbC5wYXJzZXInKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHRyIGluIHNvdXBfb3RwLnNlbGVjdCgidGFibGUgdHIiKVsxOl06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29scyA9IFt0ZC5nZXRfdGV4dChzZXBhcmF0b3I9IiAiLCBzdHJpcD1UcnVlKSBmb3IgdGQgaW4gdHIuZmluZF9hbGwoInRkIildCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgY29sczogcmF3X3Jvd3MuYXBwZW5kKGNvbHMpCgogICAgICAgICAgICAgICAgICAgICAgICAjIFJldmVyc2UgTG9naWMKICAgICAgICAgICAgICAgICAgICAgICAgaWYgcmF3X3Jvd3M6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByYXdfcm93cyA9IHJhd19yb3dzWzo6LTFdCgogICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRfcm93cyA9IHJhd19yb3dzWzoxMDBdIGlmIHJhd19yb3dzIGVsc2UgW10KICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciByb3cgaW4gdYXJnZXRfcm93czoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbihyb3cpID4gbWF4KENPTF9NQVApOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBob25lID0gc3RyKHJvd1tDT0xfTUFQWzFdXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxsX21zZyA9IHN0cihyb3dbQ09MX01BUFszXV0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3RwX2NvZGUgPSBleHRyYWN0X290cChmdWxsX21zZykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWNoZV9rZXkgPSBmIntwaG9uZX1fe290cF9jb2RlfV97ZnVsbF9tc2d9IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpdGggQ0FDSEVfTE9DSzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgY2FjaGVfa2V5IG5vdCBpbiBQUk9DRVNTRURfT1RQX0NBQ0hFOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQUk9DRVNTRURfT1RQX0NBQ0hFLmFkZChjYWNoZV9rZXkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFF1ZXVlIGZvciBUZWxlZ3JhbQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudHJ5ID0gZ2V0X2Vtb2ppKHN0cihyb3dbQ09MX01BUFswXV0pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXJ2aWNlID0gc3RyKHJvd1tDT0xfTUFQWzJdXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgT1RQX1FVRVVFLnB1dCgocGhvbmUsIGNvdW50cnksIHNlcnZpY2UsIG90cCwgZnVsbF9tc2cpKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgdGltZS5zbGVlcChDSEVDS19ERUxBWSkKICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgICAgICMgU21hbGwgZXJyb3JzIHdvbid0IGJyZWFrIHRoZSBzZXNzaW9uCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoQ0hFQ0tfREVMQVkpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VuZF9lcnJvcl90ZWxlZ3JhbSgiTG9naW4gRmFpbGVkIiwgZiJTdGF0dXM6IHtwb3N0X3Jlcy5zdGF0dXNfY29kZX0iLCAiRW5naW5lIikKICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMTApCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICB0aW1lLnNsZWVwKDUpCiAgICAgICAgZmluYWxseToKICAgICAgICAgICAgc2Vzc2lvbi5jbG9zZSgpCgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIPCfmoEg4Ka44KeC4Kaq4Ka+4Kaw4Kat4Ka+4KaH4Kac4Ka+4KawIChUaHJlYWQgTW9uaXRvciAtIFJlbW92ZWQgREIgTG9naWMpCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgpkZWYgdGhyZWFkX3N1cGVydmlzb3IoKToKICAgIHdoaWxlIFRydWU6CiAgICAgICAgaWYgdGhyZWFkc19zdGF0dXNbImNvbGxlY3RvciJdIGlzIE5vbmUgb3Igbm90IHRocmVhZHNfc3RhdHVzWyJjb2xsZWN0b3IiXS5pc19hbGl2ZSgpOgogICAgICAgICAgICB0ID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9cnVuX2VuZ2luZSwgZGFlbW9uPVRydWUpCiAgICAgICAgICAgIHQuc3RhcnQoKQogICAgICAgICAgICB0aHJlYWRzX3N0YXR1c1siY29sbGVjdG9yIl0gPSB0CiAgICAgICAgICAgIHNlbmRfYWRtaW5fbG9nKCLwn5OiIENvbGxlY3RvciBUaHJlYWQgQXNzaWduZWQuIikKCiAgICAgICAgaWYgdGhyZWFkc19zdGF0dXNbInNlbmRlciJdIGlzIE5vbmUgb3Igbm90IHRocmVhZHNfc3RhdHVzWyJzZW5kZXIiXS5pc19hbGl2ZSgpOgogICAgICAgICAgICB0ID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9dGVsZWdyYW1fd29ya2VyLCBkYWVtb249VHJ1ZSkKICAgICAgICAgICAgdC5zdGFydCgpCiAgICAgICAgICAgIHRocmVhZHNfc3RhdHVzWyJzZW5kZXIiXSA9IHQKICAgICAgICAgICAgc2VuZF9hZG1pbl9sb2coIuKToiBTZW5kZXIgVGhyZWFkIEFzc2lnbmVkLiIpCiAgICAgICAgCiAgICAgICAgdGltZS5zbGVlcCg1KQoKIyA9PT09PT09PT09PT09PT09CiMg4pSUIOCmuOCljeCmn+CmvuCmsOCmn+CmvuCmqwrKIyA9PT09PT09PT09PT09PT09CgppZiBfX25hbWVfXyA9PSAiX19tYWluX18iOgogICAgdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9bWVtb3J5X2NsZWFuZXIsIGRhZW1vbj1UcnVlKS5zdGFydCgpCiAgICB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD10aHJlYWRfc3VwZXJ2aXNvciwgZGFlbW9uPVRydWUpLnN0YXJ0KCkKICAgIAogICAgcG9ydCA9IGludChvcy5lbnZpcm9uLmdldCgiUE9SVCIsIDUwMDApKQogICAgYXBwLnJ1bihob3N0PScwLjAuMC4wJywgcG9ydD1wb3J0KQo=
